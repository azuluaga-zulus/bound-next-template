# Reglas de Ingeniería — Bound

## 1) Flujo de Git

- **Ramas protegidas**: `main` (prod), `develop` (staging).
- **Branches de trabajo**: `feat/*`, `fix/*`, `chore/*`, `docs/*`.
- **Pull Requests (PR)**: requieren CI verde y una revisión.
- **Mensajes de commit**: seguir _Conventional Commits_ (ej: `feat(dashboard): add KPI card`). _No bloqueamos aún por commitlint, pero será obligatorio._

## 2) Hooks locales (Husky)

- **pre-commit**: `lint-staged` (ESLint/Prettier sobre staged files). Bloquea si hay errores no corregibles.
- **pre-push**: `pnpm typecheck && pnpm build`. Bloquea push si el tipo o el build fallan.

## 3) Código y estilo

- **TypeScript estricto**. Evitar `any` sin justificar.
- **ESLint + Prettier**. No desactivar reglas sin motivo.
- **Nombres**: archivos y carpetas en `kebab-case`; componentes React en `PascalCase`.
- **Tailwind v4**: evitar CSS inline; utilidades y `@apply` solo cuando tenga sentido.
- **Accesibilidad**: `alt` en imágenes, roles y labels correctos, foco visible.

## 4) Next.js + React

- **Server Components por defecto**. Usa `"use client"` solo cuando haya estado, efectos, eventos o APIs de navegador.
- **Prohibido en Server**: `window`, `document`, `localStorage`, `navigator`, `fetch` de orígenes cross-user sin caché. Si dudas, es cliente.
- **SSR/Browser util**:
  - `src/lib/generateUUID.ts`: util puro, sin APIs de navegador.
  - Si necesitas APIs de navegador, crea una versión cliente (p. ej. `generateUUID.client.ts`) o un wrapper que chequee `typeof window !== 'undefined'`.

## 5) Estructura de carpetas

src/
app/ # Next App Router
(routes)/ # grupos y rutas
api/ # route handlers
components/ # UI compartida
features/ # módulos funcionales (ej. onboarding, campaigns)
lib/ # utils puros (sin efectos)
services/ # integraciones (Supabase, n8n, etc.)
styles/ # estilos globales si aplica

markdown
Copy
Edit

- **Alias TS**: `@/*` apunta a `src/*` (lo confirmaremos en el paso de paths).

## 6) Entornos y secretos

- `.env.local`, `.env.staging`, `.env.production` (no commitear).
- Variables públicas: `NEXT_PUBLIC_*`. Servidor: sin el prefijo.
- GitHub Actions/Vercel/DO: secrets por entorno.

## 7) Testing mínimo

- **Type-safety**: `tsc --noEmit` en CI.
- **Unit (Vitest)**: 2–3 utils (ej. UUID, formatters).
- **E2E (Playwright)**: rutas `/`, `/login`, `/onboarding`. Headless en CI.

## 8) CI/CD (resumen)

- PR: `pnpm install --frozen-lockfile` → `pnpm lint && pnpm typecheck && pnpm build`.
- Previews: Vercel por PR (o DO App Platform).
- Producción: DO (Docker multi-stage, healthcheck `/api/health`).

## 9) Seguridad

- Secret scanning en GitHub.
- Headers seguros en `next.config.ts` y proxy (Traefik/Nginx).
- No loguear secretos; rotación periódica.

## 10) Reviews

- PRs chicos, con descripción y checklist.
- Rechazar PR si rompe lint, tipos, build o tests.
- Comentarios accionables; cambios solicitados con ejemplos.

> Mantener este documento corto, vivo y útil. Si una regla estorba al delivery sin ganar calidad real, se revisa.
